#!/usr/bin/env python3
"""
PDCA è¨˜éŒ„ä»£ç† - æ™ºèƒ½åˆ†æå’Œåˆ†é¡è¨˜æ†¶
é…åˆ claude -p ä½¿ç”¨ä¾†åˆ†æ PDCA åŸ·è¡Œéç¨‹
"""

import sys
import json
from datetime import datetime
from pathlib import Path

def generate_recorder_prompt(task_description):
    """ç”Ÿæˆè¨˜éŒ„ä»£ç†çš„åˆ†ææç¤º"""
    
    prompt = f"""# ğŸ“ PDCA è¨˜éŒ„ä»£ç†åˆ†æ

## ä»»å‹™ï¼š{task_description}

ä½œç‚º **[è¨˜éŒ„ä»£ç†]**ï¼Œè«‹åˆ†ææœ¬æ¬¡ PDCA ä»»å‹™çš„åŸ·è¡Œéç¨‹ï¼Œä¸¦å°‡é—œéµå…§å®¹åˆ†é¡è¨˜éŒ„åˆ°ç›¸æ‡‰çš„è¨˜æ†¶åº«ä¸­ã€‚

## åˆ†æè¦é»

### 1. æ±ºç­–è¨˜éŒ„ (decisions/)
- è­˜åˆ¥é‡è¦çš„æŠ€è¡“æ±ºç­–
- è¨˜éŒ„é¸æ“‡çš„ç†ç”±å’Œè€ƒé‡
- æ¨™è¨˜æ±ºç­–çš„åƒèˆ‡è€…

### 2. è§£æ±ºæ–¹æ¡ˆ (solutions/)
- å…·é«”å•é¡Œçš„è§£æ±ºæ–¹æ³•
- å¯¦æ–½æ­¥é©Ÿå’Œä»£ç¢¼ç‰‡æ®µ
- æ•ˆæœè©•ä¼°

### 3. è¨­è¨ˆæ¨¡å¼ (patterns/)
- ç™¼ç¾çš„å¯é‡ç”¨æ¨¡å¼
- æœ€ä½³å¯¦è¸ç¸½çµ
- åæ¨¡å¼è­¦å‘Š

### 4. ç¶“é©—æ•™è¨“ (learnings/)
- é‡åˆ°çš„å•é¡Œå’Œé™·é˜±
- å­¸åˆ°çš„æ–°çŸ¥è­˜
- æ”¹é€²å»ºè­°

### 5. é€²åº¦è¿½è¹¤ (progress/)
- å®Œæˆçš„é‡Œç¨‹ç¢‘
- æ™‚é–“æ¶ˆè€—åˆ†æ
- å¾ŒçºŒè¨ˆåŠƒ

## è¼¸å‡ºæ ¼å¼

è«‹ç‚ºæ¯å€‹ç›¸é—œé¡åˆ¥ç”Ÿæˆä¸€å€‹ Markdown æª”æ¡ˆï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```markdown
# [é¡åˆ¥]/YYYY-MM-DD_[ç°¡çŸ­æ¨™é¡Œ].md

## æ‘˜è¦
[ä¸€å¥è©±ç¸½çµ]

## è©³ç´°å…§å®¹
[å…·é«”åˆ†æå…§å®¹]

## æ¨™ç±¤
#æ¨™ç±¤1 #æ¨™ç±¤2 #æ¨™ç±¤3
```

è«‹é–‹å§‹åˆ†æä¸¦ç”Ÿæˆè¨˜æ†¶æª”æ¡ˆï¼"""
    
    return prompt

def main():
    """ä¸»å…¥å£å‡½æ•¸"""
    if len(sys.argv) > 1:
        # ç§»é™¤ "åˆ†æ" é—œéµå­—å¦‚æœå­˜åœ¨
        args = sys.argv[1:]
        if args[0] == "åˆ†æ" and len(args) > 1:
            args = args[1:]
        
        task_description = " ".join(args)
        
        # è®€å– PDCA ä»»å‹™è³‡è¨Šï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        pdca_file = Path(".pdca/current_task.json")
        if pdca_file.exists():
            try:
                with open(pdca_file, "r", encoding="utf-8") as f:
                    task_data = json.load(f)
                    # å¦‚æœæ²’æœ‰å‚³å…¥ä»»å‹™æè¿°ï¼Œä½¿ç”¨æª”æ¡ˆä¸­çš„
                    if not task_description and "task" in task_data:
                        task_description = task_data["task"]
            except:
                pass
        
        if not task_description:
            task_description = "æœªæŒ‡å®šä»»å‹™"
        
        prompt = generate_recorder_prompt(task_description)
        print(prompt)
    else:
        print("ä½¿ç”¨æ–¹å¼: claude -p \"pdca-recorder åˆ†æ [ä»»å‹™æè¿°]\"")
        print("æˆ–åœ¨ PDCA ç’°å¢ƒä¸­: claude -p \"pdca-recorder\"")

if __name__ == "__main__":
    main()