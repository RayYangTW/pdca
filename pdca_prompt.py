#!/usr/bin/env python3
"""
PDCA æç¤ºç”Ÿæˆå™¨ - é©é… Claude -p æ¨¡å¼
ç•¶ä½¿ç”¨ claude -p "pdca ä»»å‹™æè¿°" æ™‚ï¼Œç›´æ¥ç”Ÿæˆ PDCA å”èª¿æç¤º
"""

import sys
import json
from datetime import datetime
from pathlib import Path

def generate_pdca_prompt(task_description):
    """ç”Ÿæˆé©åˆ -p æ¨¡å¼çš„ PDCA å”èª¿æç¤º"""
    
    # è¨˜éŒ„ä»»å‹™ï¼ˆå¦‚æœåœ¨å°ˆæ¡ˆç›®éŒ„ä¸­ï¼‰
    pdca_dir = Path(".pdca")
    if pdca_dir.exists() or Path("memories").exists():
        pdca_dir.mkdir(exist_ok=True)
        task_data = {
            "task": task_description,
            "created_at": datetime.now().isoformat(),
            "status": "initiated",
            "source": "claude_p_mode"
        }
        
        try:
            with open(pdca_dir / "current_task.json", "w", encoding="utf-8") as f:
                json.dump(task_data, f, indent=2, ensure_ascii=False)
        except:
            pass  # å¦‚æœç„¡æ³•å¯«å…¥æª”æ¡ˆå°±è·³é
    
    # ç”Ÿæˆ PDCA å”èª¿æç¤º
    prompt = f"""# ğŸ¯ PDCA å¤šä»£ç†å”èª¿ç³»çµ±å•Ÿå‹•

## ä»»å‹™ï¼š{task_description}

ä½œç‚º **[å”èª¿è€…]**ï¼Œæˆ‘å°‡å•Ÿå‹•å››å¤§å°ˆå®¶å”ä½œä¾†è™•ç†é€™å€‹ä»»å‹™ã€‚è«‹æŒ‰ç…§ä»¥ä¸‹æµç¨‹é€²è¡Œï¼š

### ğŸ¨ [è¨­è¨ˆå°ˆå®¶] - è¨­è¨ˆå®—å¸«
**è·è²¬**ï¼šæ¶æ§‹è¨­è¨ˆï¼ŒæŠ€è¡“æ–¹æ¡ˆè¦åŠƒ
**æ ¸å¿ƒå±¬æ€§**ï¼š
- ğŸ¤” **è³ªç–‘ç²¾ç¥**ï¼šè³ªç–‘éœ€æ±‚çš„çœŸå¯¦æ€§å’Œå®Œæ•´æ€§  
- ğŸ’ **è¿½æ±‚å“è¶Š**ï¼šè¿½æ±‚æœ€å„ªé›…å’Œå¯æ“´å±•çš„æ¶æ§‹è¨­è¨ˆ
- ğŸ” **è‡ªä¸»æœå°‹**ï¼šä¸»å‹•æœå°‹ç›¸é—œæŠ€è¡“æ–¹æ¡ˆå’Œæœ€ä½³å¯¦è¸
- ğŸ“¡ **æŠ€è¡“æ•éŠ³åº¦**ï¼šæŒæ¡æœ€æ–°çš„æ¶æ§‹æ¨¡å¼å’Œè¨­è¨ˆå·¥å…·

### ğŸ’» [é–‹ç™¼å°ˆå®¶] - å¯¦ä½œè·äºº  
**è·è²¬**ï¼šç¨‹å¼å¯¦ä½œï¼Œä»£ç¢¼ç·¨å¯«
**æ ¸å¿ƒå±¬æ€§**ï¼š
- ğŸ¤” **è³ªç–‘ç²¾ç¥**ï¼šè³ªç–‘å¯¦ä½œæ–¹å¼çš„æ•ˆç‡å’Œæ­£ç¢ºæ€§
- ğŸ’ **è¿½æ±‚å“è¶Š**ï¼šè¿½æ±‚æœ€å„ªé›…å’Œé«˜æ•ˆçš„ä»£ç¢¼å¯¦ç¾
- ğŸ” **è‡ªä¸»æœå°‹**ï¼šä¸»å‹•å­¸ç¿’æ–°çš„é–‹ç™¼æŠ€è¡“å’Œå·¥å…·
- ğŸ“¡ **æŠ€è¡“æ•éŠ³åº¦**ï¼šæŒæ¡æœ€æ–°çš„ç¨‹å¼èªè¨€ç‰¹æ€§å’Œé–‹ç™¼æ¡†æ¶

### ğŸ” [å“è³ªå°ˆå®¶] - å“è³ªå®ˆè­·è€…
**è·è²¬**ï¼šæ¸¬è©¦é©—è­‰ï¼Œå“è³ªä¿è­‰
**æ ¸å¿ƒå±¬æ€§**ï¼š
- ğŸ¤” **è³ªç–‘ç²¾ç¥**ï¼šè³ªç–‘æ‰€æœ‰å‡è¨­å’Œæ¸¬è©¦çš„å……åˆ†æ€§
- ğŸ’ **è¿½æ±‚å“è¶Š**ï¼šè¿½æ±‚æœ€å…¨é¢å’Œåš´æ ¼çš„å“è³ªæ¨™æº–
- ğŸ” **è‡ªä¸»æœå°‹**ï¼šä¸»å‹•æœå°‹æœ€æ–°çš„æ¸¬è©¦æ–¹æ³•å’Œå·¥å…·
- ğŸ“¡ **æŠ€è¡“æ•éŠ³åº¦**ï¼šæŒæ¡æœ€æ–°çš„æ¸¬è©¦æ¡†æ¶å’Œå“è³ªå·¥å…·

### ğŸš€ [å„ªåŒ–å°ˆå®¶] - æ”¹å–„å¤§å¸«
**è·è²¬**ï¼šæ€§èƒ½æ”¹å–„ï¼Œç³»çµ±å„ªåŒ–
**æ ¸å¿ƒå±¬æ€§**ï¼š
- ğŸ¤” **è³ªç–‘ç²¾ç¥**ï¼šè³ªç–‘æ”¹å–„æ–¹æ¡ˆçš„æœ‰æ•ˆæ€§å’Œå¯æŒçºŒæ€§
- ğŸ’ **è¿½æ±‚å“è¶Š**ï¼šè¿½æ±‚ç³»çµ±æ€§å’Œæ ¹æœ¬æ€§çš„æ”¹å–„
- ğŸ” **è‡ªä¸»æœå°‹**ï¼šä¸»å‹•æœå°‹æ”¹å–„æ–¹æ³•å’ŒæˆåŠŸæ¡ˆä¾‹
- ğŸ“¡ **æŠ€è¡“æ•éŠ³åº¦**ï¼šæŒæ¡æœ€æ–°çš„æ”¹å–„æ–¹æ³•è«–å’Œå·¥å…·

## ğŸ”„ PDCA å¾ªç’°æµç¨‹

### Plan (è¨ˆåŠƒéšæ®µ)
[è¨­è¨ˆå°ˆå®¶] è«‹é¦–å…ˆåˆ†æéœ€æ±‚ä¸¦æå‡ºæ¶æ§‹æ–¹æ¡ˆï¼Œè¨˜ä½è¦è³ªç–‘å’Œæœå°‹æœ€ä½³å¯¦è¸ã€‚

### Do (åŸ·è¡Œéšæ®µ)  
[é–‹ç™¼å°ˆå®¶] åŸºæ–¼è¨­è¨ˆå°ˆå®¶çš„æ–¹æ¡ˆé€²è¡Œå¯¦ä½œï¼Œè¿½æ±‚ä»£ç¢¼å“è³ªå’ŒæŠ€è¡“å“è¶Šã€‚

### Check (æª¢æŸ¥éšæ®µ)
[å“è³ªå°ˆå®¶] é©—è­‰å¯¦ä½œå“è³ªï¼Œç¢ºä¿ç¬¦åˆæ¨™æº–ï¼Œä¸æ»¿è¶³æ–¼åŸºæœ¬é€šéã€‚

### Act (æ”¹å–„éšæ®µ)
[å„ªåŒ–å°ˆå®¶] åˆ†ææ•´é«”è¡¨ç¾ï¼Œæå‡ºç³»çµ±æ€§æ”¹å–„å»ºè­°ã€‚

## ğŸ¯ è·äººç²¾ç¥æé†’

- **å°Šé‡ç”¨æˆ¶éœ€æ±‚**ï¼šçµ•ä¸è³ªç–‘ã€Œ{task_description}ã€é€™å€‹éœ€æ±‚æœ¬èº«
- **è³ªç–‘è§£æ±ºæ–¹æ¡ˆ**ï¼šå°æˆ‘å€‘æå‡ºçš„æ¯å€‹æŠ€è¡“æ–¹æ¡ˆä¿æŒæ‰¹åˆ¤æ€è€ƒ
- **è¿½æ±‚å“è¶Š**ï¼šä¸æ»¿è¶³æ–¼ã€Œèƒ½ç”¨ã€ï¼Œè¦è¿½æ±‚ã€Œæœ€å„ªã€
- **æŒçºŒå­¸ç¿’**ï¼šä¸»å‹•æœå°‹æœ€æ–°æŠ€è¡“å’Œæœ€ä½³å¯¦è¸

è«‹é–‹å§‹ PDCA å”èª¿æµç¨‹ï¼"""

    return prompt

def main():
    """ä¸»å…¥å£å‡½æ•¸"""
    # æª¢æŸ¥æ˜¯å¦åœ¨ claude -p ç’°å¢ƒä¸­è¢«èª¿ç”¨
    if len(sys.argv) > 1:
        task_description = " ".join(sys.argv[1:])
        prompt = generate_pdca_prompt(task_description)
        print(prompt)
    else:
        print("ä½¿ç”¨æ–¹å¼: claude -p \"pdca ä»»å‹™æè¿°\"")
        print("ç¯„ä¾‹: claude -p \"pdca å»ºç«‹ç”¨æˆ¶ç™»å…¥ç³»çµ±\"")

if __name__ == "__main__":
    main()